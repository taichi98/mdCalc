<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style.css"> <!-- Cập nhật đường dẫn -->
    <script src="/script.js"></script> <!-- Cập nhật đường dẫn -->
    <title>WHO Z-Score</title>
    <link rel="icon" href="/icon.png" type="image/png">
    <style>
	 p { margin-top: 4px; margin-bottom: 4px; padding-left: 5px; }
        .zscore-form { margin-bottom: 20px; }
        .zscore-form label { display: block; margin-bottom: 5px; font-weight: bold; }
        .result-container {
		max-width: 400px;
		justify-content: space-between;
		align-items: center;
		background-color: #117D67;
		padding: 10px;
		border-radius: 10px;
		color: white;
		margin: 20px 0;
		box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1); /* Thêm shadow */
	}
	.result-item {
		display: flex;
		flex-direction: column;
		align-items: left;
		justify-content: left;
		font-size: 17px;
		flex: 1; /* Chia đều không gian cho các item */
		padding: 5px 10px;
	}
    </style>
</head>
	
<body onload="highlightSelected('item6');">
   <div class="header">
        <div class="icon-container" onclick="toggleSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none">
            <path d="M8.85719 3H15.1428C16.2266 2.99999 17.1007 2.99998 17.8086 3.05782C18.5375 3.11737 19.1777 3.24318 19.77 3.54497C20.7108 
			4.02433 21.4757 4.78924 21.955 5.73005C22.2568 6.32234 22.3826 6.96253 22.4422 7.69138C22.5 8.39925 22.5 9.27339 22.5 10.3572V13.6428C22.5 
			14.7266 22.5 15.6008 22.4422 16.3086C22.3826 17.0375 22.2568 17.6777 21.955 18.27C21.4757 19.2108 20.7108 19.9757 19.77 20.455C19.1777 20.7568 
			18.5375 20.8826 17.8086 20.9422C17.1008 21 16.2266 21 15.1428 21H8.85717C7.77339 21 6.89925 21 6.19138 20.9422C5.46253 20.8826 4.82234 20.7568 
			4.23005 20.455C3.28924 19.9757 2.52433 19.2108 2.04497 18.27C1.74318 17.6777 1.61737 17.0375 1.55782 16.3086C1.49998 15.6007 1.49999 14.7266 1.5 
			13.6428V10.3572C1.49999 9.27341 1.49998 8.39926 1.55782 7.69138C1.61737 6.96253 1.74318 6.32234 2.04497 5.73005C2.52433 4.78924 3.28924 4.02433 
			4.23005 3.54497C4.82234 3.24318 5.46253 3.11737 6.19138 3.05782C6.89926 2.99998 7.77341 2.99999 8.85719 3ZM6.35424 5.05118C5.74907 5.10062 5.40138 
			5.19279 5.13803 5.32698C4.57354 5.6146 4.1146 6.07354 3.82698 6.63803C3.69279 6.90138 3.60062 7.24907 3.55118 7.85424C3.50078 8.47108 3.5 9.26339 3.5 
			10.4V13.6C3.5 14.7366 3.50078 15.5289 3.55118 16.1458C3.60062 16.7509 3.69279 17.0986 3.82698 17.362C4.1146 17.9265 4.57354 18.3854 5.13803 18.673C5.40138 
			18.8072 5.74907 18.8994 6.35424 18.9488C6.97108 18.9992 7.76339 19 8.9 19H9.5V5H8.9C7.76339 5 6.97108 5.00078 6.35424 5.05118ZM11.5 5V19H15.1C16.2366 19 
			17.0289 18.9992 17.6458 18.9488C18.2509 18.8994 18.5986 18.8072 18.862 18.673C19.4265 18.3854 19.8854 17.9265 20.173 17.362C20.3072 17.0986 20.3994 16.7509 
			20.4488 16.1458C20.4992 15.5289 20.5 14.7366 20.5 13.6V10.4C20.5 9.26339 20.4992 8.47108 20.4488 7.85424C20.3994 7.24907 20.3072 6.90138 20.173 6.63803C19.8854 
			6.07354 19.4265 5.6146 18.862 5.32698C18.5986 5.19279 18.2509 5.10062 17.6458 5.05118C17.0289 5.00078 16.2366 5 15.1 5H11.5ZM5 8.5C5 7.94772 5.44772 7.5 6 
			7.5H7C7.55229 7.5 8 7.94772 8 8.5C8 9.05229 7.55229 9.5 7 9.5H6C5.44772 9.5 5 9.05229 5 8.5ZM5 12C5 11.4477 5.44772 11 6 11H7C7.55229 11 8 11.4477 8 12C8 
			12.5523 7.55229 13 7 13H6C5.44772 13 5 12.5523 5 12Z" fill="#FFFFFF"/>
        </svg>
		<span class="tooltip-text">Mở Sidebar</span>
        </div>
	<div class="header-title"> MEDICAL CALCULATOR </div>
    </div>

    <div id="mySidebar" class="sidebar"> 
        <a id="item1" href="/" onclick="loadPage('cpap.html'); highlightSelected('item1');">CPAP Calculator</a>
        <a id="item2" href="/" onclick="loadPage('ett.html'); highlightSelected('item2');">ETT Size</a>
        <a id="item3" href="/" onclick="loadPage('bmi.html'); highlightSelected('item3');">BMI & BSA Calculator</a>
	<a id="item4" href="/" onclick="loadPage('lightCriteria.html'); highlightSelected('item4');">Light's Criteria</a>
	<a id="item5" href="/" onclick="loadPage('ibw.html'); highlightSelected('item5');">Ideal Body Weight</a>
        <a id="item6" href="javascript:void(0)" onclick="highlightSelected('item6');">WHO Z-Score</a>
    </div>
	
    <div id="myOverlay" class="overlay" onclick="toggleSidebar()"></div>

<div id="main">
    <div class="container_of_content">
        <div class="description-box">
	     <h3>Child growth standards</h3>
	     <p>This web site presents the WHO Child Growth Standards. These standards were developed using data collected in the WHO Multicentre Growth Reference Study. The site presents documentation on how the physical growth curves and motor milestone windows of achievement were developed as well as application tools to support the implementation of the standards</p>
	</div>
	    
	<div class="calculation-box">
          <h1>WHO Z-Score Tool</h1>
          <form id="zscore-form">
            <label for="gender">Sex</label>
                <div class="select-group">
                    <button type="button" id="male-btn" onclick="selectGender('male')">Male</button>
                    <button type="button" id="female-btn" onclick="selectGender('female')">Female</button>
                </div>
	    <input type="hidden" id="gender" name="sex" required>
	    <span id="gender-error" style="margin-bottom: 5px; color: red; display: none;">Please select a gender.</span>

	<div class="container_date_input">
	    <div class="field_date_input">
	        <label for="dob">Date of Birth:</label>
	        <input type="date" id="dob" name="dob" required style="display: none;">
	        <input type="text" id="dob-formatted" readonly placeholder="dd/mm/yyyy" onclick="document.getElementById('dob').showPicker()">
	    </div>
	    <div class="field_date_input">
	        <label for="current-day">Current Day:</label>
	        <input type="date" id="current-day" name="current_day" required style="display: none;">
	        <input type="text" id="current-day-formatted" readonly placeholder="dd/mm/yyyy" onclick="document.getElementById('current-day').showPicker()">
	    </div>
	</div>
	<div id="age-display" style="margin-bottom: 10px; font-weight: bold; color: red;"></div>
 
	<label for="measured">Measured:</label>
	<div class="select-group">
	    <button type="button" id="recumbent-btn" onclick="selectMeasured('l')" class="active">Recumbent</button>
	    <button type="button" id="standing-btn" onclick="selectMeasured('h')">Standing</button>
	</div>	
	<input type="hidden" id="measured" name="measure" value="l">
		  
            <label for="height">Height (cm):</label>
            <input type="number" id="height" name="height" step="0.1" required>
            <br>
            <label for="weight">Weight(kg):</label>
            <input type="number" id="weight" name="weight" step="0.1" required>
            <br>
            <button type="submit">Calculate</button>
        </form>
	<div id="result" class="result-container">
		<div style="font-size: 1.17em; font-weight: bold; margin-bottom: 8px; padding-left: 5px;">Result:</div>
		<p id="text1">Please fill out required fields.</p>
		<div id="resultZS" style="display: none;">
		<div class="result-item">
			<p id="bmi-result"></p>
			<p id="weight_lenhei_result"></p>
			<p id="wei-result"></p>
			<p id="lenhei_age_result"></p>
			<p id="bmiage-result"></p>
		</div>
		</div>                
	</div>	
		
	</div>
    </div>
</div>
    <script>
	  // Đặt ngày hiện tại cho "Current Day" khi trang tải
	  window.addEventListener('DOMContentLoaded', () => {
		const today = new Date();
		const formattedToday = formatDate(today);
		document.getElementById("current-day").valueAsDate = today;
		document.getElementById("current-day-formatted").value = formattedToday;
		
		// Đặt giới hạn cho ô "Date of Birth" để không cho phép chọn ngày sau ngày hiện tại
		document.getElementById("dob").setAttribute("max", today.toISOString().split("T")[0]);
	  });
	
	  // Hàm định dạng ngày thành dd/mm/yyyy
	  function formatDate(date) {
	    const day = ('0' + date.getDate()).slice(-2);
	    const month = ('0' + (date.getMonth() + 1)).slice(-2);
	    const year = date.getFullYear();
	    return `${day}/${month}/${year}`;
	  }
	
	  // Khi chọn ngày sinh, cập nhật trường hiển thị
	  document.getElementById("dob").addEventListener("change", function() {
	    const date = new Date(this.value);
	    document.getElementById("dob-formatted").value = formatDate(date);
	    updateAgeDisplay();
	  });
	
	  // Khi chọn ngày hiện tại, cập nhật trường hiển thị
	  document.getElementById("current-day").addEventListener("change", function() {
	    const date = new Date(this.value);
	    document.getElementById("current-day-formatted").value = formatDate(date);
	    updateAgeDisplay();
	  });
	    
        function calculateAgeInDays(dob, currentDay) {
            const birthDate = new Date(dob);
            const currentDate = new Date(currentDay);
            const timeDifference = currentDate - birthDate;
            const ageInDays = Math.floor(timeDifference / (1000 * 60 * 60 * 24));
            return ageInDays;
        }
	    
	function updateAgeDisplay() {
	    const dob = document.getElementById("dob").value;
	    const currentDay = document.getElementById("current-day").value;
	    
	    if (dob && currentDay) {
	        const birthDate = new Date(dob);
	        const currentDate = new Date(currentDay);
	        let ageYears = currentDate.getFullYear() - birthDate.getFullYear();
	        let ageMonths = currentDate.getMonth() - birthDate.getMonth();
	        let ageDays = currentDate.getDate() - birthDate.getDate();
	
	        if (ageMonths < 0 || (ageMonths === 0 && ageDays < 0)) {
	            ageYears--;
	            ageMonths += 12;
	        }
	        if (ageDays < 0) {
	            const prevMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);
	            ageDays += prevMonth.getDate();
	            ageMonths--;
	        }
		// Tính tổng số tháng tuổi
	        const totalMonths = ageYears * 12 + ageMonths;
	        // Kiểm tra nếu tuổi vượt quá 60 tháng
	        if (totalMonths > 60) {
	            alert("We only compute z-scores for children age < 60 months.");
	            document.getElementById('age-display').innerHTML = ""; // Xóa kết quả nếu có
	            return; // Ngăn không cho tiếp tục tính toán
	        }  
		if (totalMonths >=24) {
		   selectMeasured('h');
		} else { selectMeasured('l');}
	        // Tạo chuỗi hiển thị tuổi dựa trên các điều kiện
	        let ageDisplayText = "";
	        if (ageYears === 0 && ageMonths === 0 && ageDays <= 30) {
	            // Trường hợp tuổi <= 30 ngày
	            ageDisplayText = `Age: <b>${ageDays}</b> day(s)`;
	        } else if (ageYears === 0 && ageMonths <= 12) {
	            // Trường hợp tuổi <= 12 tháng
	            ageDisplayText = `Age: <b>${ageMonths}</b> month(s), ${ageDays} day(s)`;
	        } else {
	            // Trường hợp tuổi > 12 tháng
	            ageDisplayText = `Age: <b>${ageYears}</b> year(s), ${ageMonths} month(s), ${ageDays} day(s)`;
	        }
	
	        // Cập nhật kết quả hiển thị
	        document.getElementById('age-display').innerHTML = ageDisplayText;
	    }
	}


  document.getElementById('zscore-form').addEventListener('submit', function(event) {
        event.preventDefault();
	// Kiểm tra nếu giới tính chưa được chọn
        if (!gender) {
            document.getElementById('gender-error').style.display = 'block';
            return // Ngăn chặn form gửi đi nếu chưa chọn giới tính
        }
            const formData = new FormData(this);
            // Lấy giá trị của 'dob' và 'current-day' từ form
            const dob = document.getElementById('dob').value;
            const currentDay = document.getElementById('current-day').value;
            // Tính toán ageInDays
            const ageInDays = calculateAgeInDays(dob, currentDay);
            // Thêm ageInDays vào FormData
            formData.append('ageInDays', ageInDays);

            fetch('/zscore-calculator', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('bmi-result').innerText = `BMI: ${data.bmi}`;
                document.getElementById('bmiage-result').innerText = `BMI for Age: ${data.bmi_age}`;
                document.getElementById('wei-result').innerText = `Weight for Age: ${data.wei}`;
		document.getElementById('lenhei_age_result').innerText = `Height for Age: ${data.lenhei_age}`;
		document.getElementById('weight_lenhei_result').innerText = `Weight for Lenght: ${data.wfl}`;
            });
	document.getElementById('text1').style.display = 'none'; // Ẩn placeholder
	document.getElementById('resultZS').style.display = 'flex'; // Hiển thị kết quả
        });
    </script>
</body>
</html>
